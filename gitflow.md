# Именование бранчей

|Имя ветки       | Описание |
|----------------|----------|
|master          | Ветка содержит только то, что выехало в прод. После мержа в ```master``` необходимо назначить ```tag``` с номером версии, чтобы она стала отображаться в [релизах](https://github.com/aurusov/rdo-xtext/releases). Нумерация по правилам [deb-version](http://manpages.ubuntu.com/manpages/natty/man5/deb-version.5.html). Если кратко, то версия состоит из трёх чисел ```major.minor.fix```. Если в новой версии теряется обратная совместимость, то увеличивается ```major```. Если добавили новую фичу - ```minor```. Если исправили баг - ```fix```.
|release/current | Основная ветка. Как правило, совпадает с ```master```. Когда в мастер выехал новый релиз или hotfix, то его надо подмержить в ```release/current```. Подмержить именно ```master -> release/current```, а не релиз или hotfix. От этой ветки создаются бранчи для разработки фич и релизные ветки. Используется для рефакторинга кода - он заливается прямо сюда. Т.е. вновь созданные фичи будут включать отрефакторенный код даже до выхода нового релиза. А в текущие фичи-ветки рефакторинг подмерживается руками.|
|release/version | Создаётся от ```release/current```. Используется для подготовки нового номерного релиза. Имеет формат ```release/major.minor```, например, ```release/1.2```. Означает, что мы или выпускаем продукт с новой фичей под версией ```1.2.0``` или правим баг. Если баг, то окончательная версия может быть ```1.2.7```. В эту ветку подливаются все фичи-ветки, которые готовятся к релизу. Важно - это ветка может быть удалена в любой момент и пересоздана. Никаких коммитов с кодом в ней быть не должно. Только мержи фичи-веток. Когда ветка готова к выходу в прод, отдельным коммитом изменяются версии командой <pre>mvn org.eclipse.tycho:tycho-versions-plugin:set-version "-DnewVersion=&lt;New Version&gt;"</pre> или вручную в файлах<ul><li> [`ru.bmstu.rk9.rao.lib/META-INF/MANIFEST.MF`](/ru.bmstu.rk9.rao.lib/META-INF/MANIFEST.MF#L5)</li><li>[`ru.bmstu.rk9.rao.sdk/feature.xml`](/ru.bmstu.rk9.rao.sdk/feature.xml#L4)</li><li>[`ru.bmstu.rk9.rao.tests/META-INF/MANIFEST.MF`](/ru.bmstu.rk9.rao.tests/META-INF/MANIFEST.MF#L5)</li><li>[`ru.bmstu.rk9.rao.ui/META-INF/MANIFEST.MF`](ru.bmstu.rk9.rao.ui/META-INF/MANIFEST.MF#L5)</li><li>[`ru.bmstu.rk9.rao/META-INF/MANIFEST.MF`](/ru.bmstu.rk9.rao/META-INF/MANIFEST.MF#L5)</li><li>[`pom.xml`](/pom.xml#L21)</li><li>[`assembly/pom.xml`](assembly/pom.xml#L9)</li><li>[`ru.bmstu.rk9.rao/pom.xml`](ru.bmstu.rk9.rao/pom.xml#L9)</li><li>[`ru.bmstu.rk9.rao.lib/pom.xml`](ru.bmstu.rk9.rao.lib/pom.xml#L9)</li><li>[`ru.bmstu.rk9.rao.sdk/pom.xml`](ru.bmstu.rk9.rao.sdk/pom.xml#L9)</li><li>[`ru.bmstu.rk9.rao.tests/pom.xml`](ru.bmstu.rk9.rao.tests/pom.xml#L9)</li><li>[`ru.bmstu.rk9.rao.ui/pom.xml`](ru.bmstu.rk9.rao.ui/pom.xml#L9)</li></ul>После этого ветка мержится в мастер. После мержа должна быть удалена вместе со всем выехавшими фича-ветками.|
feature/name    | Создаётся от ```release/current```. Используется для разработки нового функционала (фичи). В конце работы должна быть влита в ```release/version```. В неё в любой момент времени может быть подлит ```release/current```. С другими ветками она не должна мержиться, потому что в релиз поедет непонятно что.
bug/name        | Создаётся от ```release/current```. Используется для исправления ошибок, если фича-ветка уже удалена. На практике нужна редко, потому что разработка и отладка фичи довольно долго ведётся в её ветке.
refactoring/name | Создаётся от ```release/current```. Используется для рефакторинга существующего кода. В конце работы должна быть влита сразу в ```release/current```. Версия проекта в результате рефакторинга не изменяется.
hotfix/name     | Создаётся от ```master```. Используется для срочного исправления кода в мастере, в обход всех веток. Результат мержится в мастер и ветка удаляется. Как всегда, код из мастера подмерживается в ```release/current``` и далее по фичам. Даже не знаю, когда такое может понадобиться при разработке РДО. Написано для полноты картины.

# Что там с форками
Имя ветки                            | Описание
-------------------------------------|---------
master и resease/current             | Живут только в основном репозитории. Должны быть уникальными на все форки.
release/version                      | Живёт в форке отвественного за релиз. Ветка должна быть уникальной на все форки. По умолчанию в основном репозитории
feature/name, bug/name, refactoring/name, hotfix/name | Живут в том форке, где по ним ведётся разработка

# Как подлить результаты работы в корневой репозиторий
Скорее всего, ваша фича-ветка в конце разработки будет отставать от release/current корневого репозитория. Потому что ваши коллеги могли сделать курсач раньше и подлить туда наработки. Проверить это можно через [Network](https://github.com/aurusov/rdo-xtext/network). Поэтому сначала надо подлить в фича-ветку release/current корневого репозитория:
- [Перед мержем](https://help.github.com/articles/configuring-a-remote-for-a-fork/), в нашем случае ```git remote add upstream git@github.com:aurusov/rdo-xtext.git```
- [Инструкция](https://help.github.com/articles/syncing-a-fork/), как мержиться с форком, в нашем случае ```git merge upstream/release/current```

Во время мержа могут возникнуть конфликты. Их надо разрешить руками, вникая в изменения. В идеальном мире вы даже пообщаетесь голосом с людьми, код которых конфликтует с вашим. После разрешения всех конфликтов заливаете изменения к себе в фича-ветку. Рекомендуется **как можно чаще** мержиться с release/current корневого репозитория в процессе работы над курсовым. Это резко снижает вероятность конфликтов в конце полугодовой работы.

После мержа надо поставить пул-реквест на релиз с номером в корневом репозитории, например, на ветку ```release/1.2``` . Если такой ветки нет, то её должен создать владелец корневого репозитория, напишите ему. На пул-реквесте код обсуждается, по необходимости вносятся правки. В конце процесса нажимается кнопка ```Merge``` в гитхабе. Система предложит степерь фича-ветку - не надо этого делать. Фича-ветка удаляется руками тогда, когда релиз с номером замержится в ```master```.
