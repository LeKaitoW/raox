<html>
<head>
<link rel="stylesheet" type="text/css" href="../styles/rao_general.css">
<link rel="stylesheet" href="../styles/rao_highlight.css">
<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
<script src="../scripts/thirdparty/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="../scripts/thirdparty/jquery-2.1.4.min.js"></script>
<script src="../scripts/table_of_contents.js"></script>
</head>
<body>
<h2>Ресурсы</h2>
<h3>Объявление типа ресурса</h3>
<p>Объявление типа ресурса производится указанием ключевого слова <code class="rao">type</code>.</p>
<pre><code class="rao">type <i>Имя_типа</i> {
    <i>список_параметров</i>
}</code></pre>
<p>Тело типа ресурса представляет собой список произвольного числа параметров (но не менее одного), заключенный в фигурные скобки. Параметры разделяются точками с запятой.</p>
<pre><code class="rao"><i>имя_типа</i> <i>имя_параметра</i> [= <i>значение_по_умолчанию</i>]</code></pre>
<p>Параметр ресурса может иметь один из стандартных типов данных языка.</p>
<pre><code class="rao">enum Тип_станка {Фрезерный, Токарный}
enum Состояние_станка {Простаивает, Работает, Требует_ремонта, Требует_переналадки}

type Станок {
    int номер
    String название
    Тип_станка тип
    Состояние_станка состояние
}
</code></pre>
<h3>Создание ресурса</h3>
<p>Для создания ресурса вызывается статический метод <code class="rao">create()</code> у типа ресурса. В данном случае тип ресурса выступает в роли фабрики. В метод <code class="rao">create()</code> передается список значений параметров ресурса, которыми ресурс будет проинициализирован при создании.</p>
<pre><code class="rao"><i>Имя_типа</i>.create(<i>список_параметров</i>)</code></pre>
<p>Примеры:</p>
<pre><code class="rao">def init() {
    Станок.create(1, "16К20", Тип_станка.Токарный, Состояние_станка.Простаивает)
    Станок.create(2, "16К20", Тип_станка.Токарный, Состояние_станка.Простаивает)
    Станок.create(3, "16К20", Тип_станка.Токарный, Состояние_станка.Простаивает)
}
</code></pre>
<p>В описанной выше конструкции ресурс создается без имени. Для создания ресурса, к параметрам которого можно будет обращаться в модели по имени, в левой части конструкции указывается ключевое слово <code class="rao">resource</code> и имя ресурса, а в правой - конструкция создания ресурса.</p>
<pre><code class="rao">resource <i>имя_ресурса</i> = <i>Имя_типа</i>.create(<i>список_параметров</i>)</code></pre>
<p>В случае, если ресурс создается в модели глобально и имеет имя, к его параметрам можно обратиться в любом месте. Если ресурс создается с именем в теле образца или события, это имя имеет смысл только локально, и при обращении к ресурсу из других частей модели требуется пользоваться механизмом релевантных ресурсов.</p>
<pre><code class="rao">resource заготовка = Заготовка.create(1, 0.420, Тип_заготовки.Вал, Состояние_заготовки.Транспортируется) // имя ресурса определено глобально

event Поступление_заготовки() {
    var заготовка_ = Заготовка.create(2, 0.550, Тип_заготовки.Вал, Состояние_заготовки.Транспортируется) // имя ресурса определено локально
    заготовка_.вес = 0 // обращение к ресурсу по локальному имени
    заготовка.вес = 0 // обращение к ресурсу по глобальному имени
}
</code></pre>
<h3>Удаление ресурса</h3>
<p>Для удаления ресурса у него вызывается метод <code class="rao">erase()</code>. Удалены могут быть ресурсы, подобранные в образце как релевантные, либо ресурсы с локальными именами (но только до тех пор, пока их имя не вышло из области видимости). Удалять ресурсы при обращении по глобальному имени запрещено.</p>
<pre><code class="rao">rule Вывоз_обработанных_заготовок() {
    relevant заготовка = Заготовка.accessible.filter[состояние == Состояние_заготовки.Обработана].any
    def execute() {
        заготовка.erase()
    }
}
</code></pre>
</body>
</html>
